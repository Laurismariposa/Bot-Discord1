import discord
from discord.ext import commands
from bot_logic import gen_pass
# La variable intents almacena los privilegios del bot
intents = discord.Intents.default()
# Activar el privilegio de lectura de mensajes
intents.message_content = True
# Crear un bot en la variable cliente y transferirle los privilegios
bot = commands.Bot(command_prefix="$",intents=intents)

 
@bot.event
async def on_ready():
    print(f'Hemos iniciado sesiÃ³n como {bot.user}')

@bot.command()
async def hello(ctx):
    # 1. Crear el Embed
    embed = discord.Embed(
        title="ğŸ‘‹ Â¡Hola! Soy tu bot personalizado.",
        description="Gracias por saludar. Â¡Usa `$help` para ver mis comandos!",
        color=discord.Color.blue()
    )
    # 2. Agregar informaciÃ³n opcional
    embed.add_field(name="Mi Prefijo", value="`$`", inline=True)
    # 3. SoluciÃ³n: Usar .display_avatar.url para obtener siempre una URL vÃ¡lida
    embed.set_footer(
        text=f"Solicitado por {ctx.author.name}", 
        icon_url=ctx.author.display_avatar.url # Â¡CAMBIO CLAVE AQUÃ!
    )
    
    # 4. Enviar el Embed
    await ctx.send(embed=embed)

@bot.command()
async def bye(ctx):
    await ctx.send("GoodbyeğŸ¥²")

@bot.command()
async def password (ctx, numbers:int):
    await ctx.send(gen_pass(numbers))


@bot.command()
async def repeat(ctx, times: int, *, content='repeating...'): # <-- CAMBIO CLAVE AQUÃ: Se aÃ±ade el *
    """Repite un mensaje varias veces. Uso: $repeat <nÃºmero> [mensaje]"""

    # Si el usuario no proporciona un mensaje, se usa el valor por defecto.
    if not content:
        content = 'repeating...'

    # Se asegura que el nÃºmero no sea demasiado grande para evitar spam
    if times > 10:
        await ctx.send(f"âš ï¸ El nÃºmero de repeticiones es demasiado alto ({times}). Lo limitarÃ© a **10**.")
        times = 10
    
    if times <= 0:
        await ctx.send("El nÃºmero de repeticiones debe ser positivo.")
        return

    # Bucle de repeticiÃ³n
    for i in range(times):
        await ctx.send(content)


