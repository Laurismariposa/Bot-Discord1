import discord
from discord.ext import commands
import os
import random
from bot_logic import gen_pass
from bot_logic import get_dog_image_url
from bot_logic import get_fox_image_url
# La variable intents almacena los privilegios del bot
intents = discord.Intents.default()
# Activar el privilegio de lectura de mensajes
intents.message_content = True
# Crear un bot en la variable cliente y transferirle los privilegios
bot = commands.Bot(command_prefix="$",intents=intents)

 
@bot.event
async def on_ready():
    print(f'Hemos iniciado sesi贸n como {bot.user}')

@bot.command()
async def hello(ctx):
    # 1. Crear el Embed
    embed = discord.Embed(
        title=" 隆Hola! Soy tu bot personalizado.",
        description="Gracias por saludar. 隆Usa `$help` para ver mis comandos!",
        color=discord.Color.blue()
    )
    # 2. Agregar informaci贸n opcional
    embed.add_field(name="Mi Prefijo", value="`$`", inline=True)
    # 3. Soluci贸n: Usar .display_avatar.url para obtener siempre una URL v谩lida
    embed.set_footer(
        text=f"Solicitado por {ctx.author.name}", 
        icon_url=ctx.author.display_avatar.url # 隆CAMBIO CLAVE AQU!
    )
    
    # 4. Enviar el Embed
    await ctx.send(embed=embed)

@bot.command()
async def bye(ctx):
    await ctx.send("Goodbyeゲ")

@bot.command()
async def password (ctx, numbers:int):
    await ctx.send(gen_pass(numbers))


@bot.command()
async def repeat(ctx, times: int, *, content='repeating...'): # <-- CAMBIO CLAVE AQU: Se a帽ade el *
    """Repite un mensaje varias veces. Uso: $repeat <n煤mero> [mensaje]"""

    # Si el usuario no proporciona un mensaje, se usa el valor por defecto.
    if not content:
        content = 'repeating...'

    # Se asegura que el n煤mero no sea demasiado grande para evitar spam
    if times > 10:
        await ctx.send(f"锔 El n煤mero de repeticiones es demasiado alto ({times}). Lo limitar茅 a **10**.")
        times = 10
    
    if times <= 0:
        await ctx.send("El n煤mero de repeticiones debe ser positivo.")
        return

    # Bucle de repetici贸n
    for i in range(times):
        await ctx.send(content)

@bot.command()
async def mem(ctx):
    with open('Image/Meme1.jpeg','rb') as f:
        # 隆Vamos a almacenar el archivo de la biblioteca Discord convertido en esta variable!
        picture = discord.File(f)
        # A continuaci贸n, podemos enviar este archivo como par谩metro.
    await ctx.send(file=picture)

@bot.command()
async def meme_aleatorio(ctx):
    memealet = random.choice(os.listdir("Image"))
    with open(f'Image/{memealet}','rb') as f:
        # 隆Vamos a almacenar el archivo de la biblioteca Discord convertido en esta variable!
        picture = discord.File(f)
        # A continuaci贸n, podemos enviar este archivo como par谩metro.
    await ctx.send(file=picture)

@bot.command('dog')
async def dog(ctx):
    '''Una vez que llamamos al comando duck, 
    el programa llama a la funci贸n get_duck_image_url'''
    image_url = get_dog_image_url()
    await ctx.send(image_url)

@bot.command()
async def fox(ctx):
    '''Una vez que llamamos al comando duck, 
    el programa llama a la funci贸n get_duck_image_url'''
    image_url = get_fox_image_url()
    await ctx.send(image_url)


